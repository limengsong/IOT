(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b561c32"],{"60a0":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[n("top-bottom",{scopedSlots:e._u([{key:"top",fn:function(){return[n("Card",{staticStyle:{height:"100%"},attrs:{title:"打印机列表"}},[n("ButtonGroup",[n("i-button",{attrs:{icon:"md-refresh"},on:{click:e.refresh}}),n("i-button",{attrs:{icon:"md-add-circle",disabled:e.testDis},on:{click:e.register}})],1),n("i-switch",{attrs:{disabled:e.testDis},on:{"on-change":e.testOpen},model:{value:e.testStatus,callback:function(t){e.testStatus=t},expression:"testStatus"}}),n("Table",{ref:"currentRowTable",attrs:{"highlight-row":"",columns:e.printerColumns,data:e.printerData},on:{"on-row-click":e.onClick}})],1)]},proxy:!0},{key:"bottom",fn:function(){return[n("Card",{style:e.logStyle},[n("p",{attrs:{slot:"title"},slot:"title"},[e._v(" 调试日志 ")]),n("p",{attrs:{slot:"extra"},slot:"extra"},[n("Button",{attrs:{icon:"ios-trash"},on:{click:e.trash}},[e._v("清空")])],1),e._l(e.logList,(function(t,r){return n("div",{key:r,style:{color:e.getColors(t)}},[e._v(" "+e._s(t)+" ")])}))],2)]},proxy:!0}])}),n("Modal",{attrs:{title:"注册"},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[n("Form",{ref:"deviceItem",attrs:{model:e.deviceItem,rules:e.ruleDevice,"label-width":80}},[n("FormItem",{attrs:{label:"编码",prop:"code"}},[n("Input",{attrs:{placeholder:"请输入设备编码"},model:{value:e.deviceItem.code,callback:function(t){e.$set(e.deviceItem,"code",t)},expression:"deviceItem.code"}})],1),n("FormItem",{attrs:{label:"名称"}},[n("Input",{attrs:{disabled:"disabled",placeholder:"请输入设备名称"},model:{value:e.deviceItem.name,callback:function(t){e.$set(e.deviceItem,"name",t)},expression:"deviceItem.name"}})],1),n("FormItem",{attrs:{label:"类型"}},[n("Input",{attrs:{disabled:"disabled"},model:{value:e.deviceItem.type,callback:function(t){e.$set(e.deviceItem,"type",t)},expression:"deviceItem.type"}})],1),n("FormItem",{attrs:{label:"通信地址",prop:"wsAddress"}},[n("Select",{model:{value:e.deviceItem.wsAddress,callback:function(t){e.$set(e.deviceItem,"wsAddress",t)},expression:"deviceItem.wsAddress"}},e._l(e.printerUrl,(function(t){return n("Option",{key:t.value,attrs:{value:t.text}},[e._v(" "+e._s(t.text)+" ")])})),1)],1),n("FormItem",{attrs:{label:"工作站"}},[n("Select",{model:{value:e.deviceItem.wkStation,callback:function(t){e.$set(e.deviceItem,"wkStation",t)},expression:"deviceItem.wkStation"}},e._l(e.allWks,(function(t){return n("Option",{key:t.code,attrs:{value:t.code}},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"text"},on:{click:function(t){return e.cancel("deviceItem")}}},[e._v("取消")]),n("Button",{directives:[{name:"click-time",rawName:"v-click-time"}],attrs:{type:"primary"},on:{click:function(t){return e.ok("deviceItem")}}},[e._v("确定")])],1)],1)],1)},s=[],i=(n("a4d3"),n("e01a"),n("d28b"),n("99af"),n("4de4"),n("caad"),n("b0c0"),n("d3b7"),n("2532"),n("3ca3"),n("ddb0"),n("96cf"),n("1da1")),a=n("23f4"),o=n("c6e7"),c={components:{topBottom:a["b"]},mixins:[o["a"]],data:function(){var e=this,t=function(t,n,r){if(!n)return r(new Error("code:".concat(n,"不能为空!")));var s='query($code:String!) {\n                                    db_exists(\n                                        type:"Device"\n                                        where:{\n                                        id_not:null\n                                        code: $code\n                                        }\n                                    )\n                                    }',i={query:s,variables:{code:n}};e.$ajax.post("webs/check",null,i).then((function(e){console.log("res.data.db_exists",e.data.db_exists),e.data.db_exists?r(new Error("code:".concat(n,"已经存在！"))):r()}))};return{modalVisible:!1,logStyle:{height:"100%"},testDis:!0,testStatus:!1,printerColumns:[{type:"index",width:60,align:"center"},{title:"Name",key:"name"},{title:"PrinterName",key:"printerDrv"}],printerData:[],logList:[],selectRow:{},deviceItem:{code:"",name:"",type:"",wsAddress:"",wkStation:""},localIpAdds:[],printerUrl:[],allWks:[],ruleDevice:{code:[{validator:t,trigger:"blur"}],wsAddress:[{required:!0,message:"请选择设备通信地址"}]}}},methods:{cancel:function(e){this.modalVisible=!1,this.$refs[e].resetFields()},ok:function(e){var t=this;this.$refs[e].validate(function(){var n=Object(i["a"])(regeneratorRuntime.mark((function n(r){var s,i,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!r){n.next=16;break}return s={},s.code=t.$refs[e].model.code,s.name=t.$refs[e].model.name,s.deviceType=t.$refs[e].model.type,s.address=t.$refs[e].model.wsAddress,s.status="REGISTER",s.workStation={connect:{code:t.$refs[e].model.wkStation}},i="\n                            mutation ($create: DeviceCreateInput!){\n                            createDevice(\n                                data:$create\n                            )\n                            {\n                                id\n                                name\n                            }\n                            }\n                         ",{query:i,variables:{create:s}},n.next=12,t.regDevice(s);case 12:a=n.sent,a&&(t.$Message.success("创建设备".concat(a,"成功！")),t.modalVisible=!1),n.next=17;break;case 16:t.$Message.error("校验设备信息失败！");case 17:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())},getPrinterList:function(){var e=this;this.$ajax.get("/red/flows").then((function(t){e.printerData=e.makePrinterList(t)}))},makePrinterList:function(e){var t=[],n=e.filter((function(e){return"label-printer"===e.type})),r=!0,s=!1,i=void 0;try{for(var a,o=n[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var c=a.value,l=!0,d=!1,u=void 0;try{for(var m,v=e[Symbol.iterator]();!(l=(m=v.next()).done);l=!0){var f=m.value,p=[].concat.apply([],f.wires);if(p.includes(c.id)&&"http in"===f.type){var h=f;h.printerName=c.name,h.printerDrv=c.printer,h.type=c.type,t.push(h)}}}catch(k){d=!0,u=k}finally{try{l||null==v.return||v.return()}finally{if(d)throw u}}}}catch(k){s=!0,i=k}finally{try{r||null==o.return||o.return()}finally{if(s)throw i}}return t},onClick:function(e,t){this.selectRow=e,this.testDis=!1,console.log("row",e)},getDate:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),s=e.getHours(),i=e.getMinutes(),a=e.getSeconds();e.getSeconds();i=i>9?i:"0"+i,s>5&&s<12?s="上午"+s:s>11&&s<18?(s-=12,s="下午"+s):s>17&&s<24?(s-=12,s="晚上"+s):s="凌晨"+s,a=a>9?a:"0"+a;var o=t+"年"+n+"月"+r+"日   "+s+":"+i+":"+a;return o},getColors:function(e){return 1===e.level?"black":2===e.level?"#CD4F39":3===e.level?"#CD2626":void 0},makeLog:function(e){var t=this.getDate(),n="".concat(t,":")+"   "+"".concat(e);this.logList.unshift(n),this.logList.length>10&&(this.logStyle={})},trash:function(){this.logList=[],this.logStyle={height:"100%"}},refresh:function(){this.makeLog("从组态信息中导入数据"),this.printerData=[],this.getPrinterList(),this.testDis=!0},testOpen:function(e){if("{}"===JSON.stringify(this.selectRow))this.makeLog("未选中任何打印机"),this.testStatus=!1;else if(e){var t="CT~~CD,~CC^~CT~^XA~TA000~JSN^LT0^MNW^MTD^PON^PMN^LH0,0^JMA^PR4,4~SD15^JUS^LRN^CI0^XZ^XA^MMT^PW900^LL0600^LS0^FO96,64^GFA,09984,09984,00052,:Z64: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:9D99^BY4,3,236^FT197,490^BCN,,Y,N^FD>:DB>509100900>61^FS^FT541,202^A0N,142,86^FH^FDEBR^FS^PQ1,0,1,Y^XZ",n={data:{template:t,type:"ZPL"}},r="/api".concat(this.selectRow.url);this.sendPrint(r,n)}},register:function(){if("{}"===JSON.stringify(this.selectRow))this.makeLog("未选中任何电子称"),this.testStatus=!1;else{this.$refs["deviceItem"].resetFields(),this.printerUrl=[],this.deviceItem.name=this.selectRow.name,this.deviceItem.type="label-printer"===this.selectRow.type?"PRINTER":"Unkown";var e=this.selectRow.url;if(this.localIpAdds.length>0){var t=!0,n=!1,r=void 0;try{for(var s,i=this.localIpAdds[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var a=s.value,o={};o.value="http://".concat(a,":3000/api").concat(e),o.text="http://".concat(a,":3000/api").concat(e),this.printerUrl.push(o)}}catch(c){n=!0,r=c}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}this.modalVisible=!0}},sendPrint:function(e,t){var n=this;this.$ajax.post(e,null,t).then((function(e){var t="设备名称： ".concat(e.printer,"； 打印结果： ").concat(e.result," ");n.makeLog(t),setTimeout((function(){n.testStatus=!1}),1e3)})).catch((function(e){console.log("err",e)}))}},mounted:function(){var e=this;this.$nextTick(Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.getPrinterList(),t.next=3,e.getLocalIP();case 3:return e.localIpAdds=t.sent,t.next=6,e.getAllWks();case 6:e.allWks=t.sent;case 7:case"end":return t.stop()}}),t)}))))}},l=c,d=(n("d00d"),n("2877")),u=Object(d["a"])(l,r,s,!1,null,"7562bf0c",null);t["default"]=u.exports},d00d:function(e,t,n){"use strict";var r=n("de2c"),s=n.n(r);s.a},de2c:function(e,t,n){}}]);